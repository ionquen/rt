(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[18],{DlcB:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var c=n("nKUr"),r=n("KQm4"),s=n("rePB"),i=n("q1tI"),o=n("YFqc"),a=n.n(o),d=n("20a2"),l=n("0FX9"),u=n.n(l),j=n("uXig"),b=n.n(j),O=n("quuy"),f=n("Jq4i");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,c)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e){var t=e.props,n=Object(i.useState)([]),o=n[0],l=n[1],j=Object(i.useState)(""),h=j[0],v=j[1],y=Object(i.useState)([]),x=y[0],g=y[1],w=Object(i.useState)(!1),S=w[0],k=w[1],C=Object(i.useState)(!1),N=C[0],D=C[1],R=Object(i.useState)(null),q=R[0],M=R[1],P=Object(i.useState)(null),T=P[0],E=P[1],z=Object(i.useState)(null),J=z[0],L=z[1],I=Object(i.useRef)(null),F=Object(i.useRef)(null),U=Object(i.useRef)(null),B=Object(d.useRouter)();function _(e){M(Math.round(1e5*Math.random()));var t=Math.random().toString(36).substr(2);E(t),L(Object(c.jsx)(a.a,{href:{pathname:e,query:{key:t}},children:Object(c.jsxs)("a",{children:["https://regtool.net",e,"?key=",t]})})),D(!1)}function A(e,t,n){l((function(c){return c.map((function(c){return c.code===e?p(p({},c),{},Object(s.a)({},t,n)):c}))}))}function H(e){x.includes(e)||g([].concat(Object(r.a)(x),[e])),v(e)}return Object(i.useEffect)((function(){_(B.asPath);var e=localStorage.getItem("transferConnections");return null!==e&&l(JSON.parse(e)),function(){try{F.current.close()}catch(e){}}}),[]),Object(i.useEffect)((function(){localStorage.setItem("transferConnections",JSON.stringify(o))}),[o]),Object(i.useEffect)((function(){if(void 0!==B.query.key){l((function(e){return[{code:B.query.key,date:Date.now()}].concat(Object(r.a)(e))}));var e=B.asPath.match(/^(.*)\?/)[1];B.replace(e,void 0,{shallow:!0}),H(B.query.key),_(e)}}),[B.query.key]),Object(c.jsxs)("div",{className:b.a.block,ref:I,children:[Object(c.jsxs)("div",{className:b.a.main,children:[Object(c.jsxs)("div",{className:"".concat(b.a.new," ").concat(""===h?b.a.display:""),children:[Object(c.jsx)("div",{}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:Object(c.jsx)("div",{children:t.desc.header1})}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:t.desc.header2}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:t.desc.code.string1}),Object(c.jsxs)("div",{children:[t.desc.code.yourCode,": ",Object(c.jsx)("span",{onClick:function(){navigator.clipboard.writeText("".concat(q))},"data-tooltip":t.desc.clickToCopy,className:b.a.code,children:q})]}),Object(c.jsx)("div",{children:t.desc.code.string2}),S?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{children:t.desc.code.waiting}),Object(c.jsx)("button",{onClick:function(){k(!1),F.current.close()},children:t.desc.code.retry})]}):Object(c.jsxs)("form",{className:b.a.form,onSubmit:function(e){e.preventDefault(),k(!0),F.current=new WebSocket(t.server),F.current.onmessage=function(e){var t=JSON.parse(e.data),n=t.type,c=t.content;switch(n){case"swap":l((function(e){return[{code:c,date:Date.now()}].concat(Object(r.a)(e))})),H(c),F.current.close(),k(!1)}};var n=[e.target.code.value,q].sort().join("");F.current.onopen=function(){return F.current.send(JSON.stringify({type:"swap",content:n}))}},children:[Object(c.jsx)("input",{placeholder:t.desc.code.inputCodePlaceholder,autoComplete:"false",type:"number",name:"code"}),Object(c.jsx)("input",{type:"submit",value:t.desc.code.addContact})]})]})]}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:t.desc.header3}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:t.desc.qr.string1}),Object(c.jsx)("div",{children:t.desc.qr.string2}),Object(c.jsxs)("div",{children:[J,Object(c.jsx)("button",{onClick:function(){navigator.clipboard.writeText("https://regtool.net".concat(B.asPath,"?key=").concat(T))},children:t.desc.qr.copy})]}),Object(c.jsxs)("div",{className:N?b.a.qrTrue:b.a.qrFalse,children:[Object(c.jsx)("canvas",{ref:U}),Object(c.jsx)("button",{onClick:function(){u.a.toCanvas(U.current,"https://regtool.net".concat(B.asPath,"?key=").concat(T)),D(!0)},children:t.desc.qr.generate})]})]})]})]}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:t.desc.loss}),Object(c.jsx)("button",{onClick:_,children:t.desc.recreate})]})]}),o.map((function(e){var n=e.code,r=e.name,s=e.date,i=e.last;return x.includes(n)?Object(c.jsx)(m,{display:h===n,code:n,name:r,date:s,last:i,contactEdit:A,props:t},n):null})),Object(c.jsx)(O.a,{elem:I.current})]}),Object(c.jsxs)("div",{className:b.a.contacts,children:[Object(c.jsx)("button",{onClick:function(){return v("")},children:t.desc.add}),Object(c.jsx)("div",{children:o.map((function(e){return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{onClick:function(){return H(e.code)},children:void 0===e.name?t.desc.nameless:e.name}),Object(c.jsx)("button",{onClick:function(t){var n;t.stopPropagation(),n=e.code,l(o.filter((function(e){return e.code!==n}))),v("")},children:Object(c.jsx)(f.a,{name:"var/x.svg"})}),Object(c.jsx)("div",{children:new Date(e.date).toLocaleTimeString(void 0,{month:"short",day:"numeric",weekday:"short",year:"numeric"})}),Object(c.jsx)("div",{children:void 0===e.last?t.desc.empty:new Date(e.last).toLocaleTimeString(void 0,{month:"short",day:"numeric",weekday:"short",year:"numeric"})})]},e.code)}))})]})]})}function m(e){var t=e.code,n=e.name,o=e.date,a=e.last,d=e.display,l=e.contactEdit,u=e.props,j=Object(i.useState)([]),O=j[0],h=j[1],v=Object(i.useState)([]),m=v[0],y=v[1],x=Object(i.useState)(!1),g=x[0],w=x[1],S=Object(i.useState)(0),k=S[0],C=S[1],N=Object(i.useRef)(null),D=Object(i.useRef)(null),R=Object(i.useRef)(null),q=Object(i.useRef)(null);Object(i.useEffect)((function(){q.current.scrollTop>q.current.scrollHeight-q.current.offsetHeight-300&&(q.current.scrollTop=q.current.scrollHeight)}),[O]);var M=function(){try{R.current.close(),D.current.close(),N.current.close()}catch(e){}};Object(i.useEffect)((function(){0===k&&P({type:"sys",content:u.desc.msg.sysNew})}),[k]);var P=function(e){return h((function(t){return[].concat(Object(r.a)(t),[e])}))},T=function(e,t,n){return h((function(c){return c.map((function(c){return c.id===e?p(p({},c),{},Object(s.a)({},t,n)):c}))}))};function E(){var e=Date.now();return{date:6e4*Math.floor(e/6e4),id:e%1e5}}function z(e,t){var n=document.createElement("a");n.download=t,n.href=URL.createObjectURL(e),n.click(),URL.revokeObjectURL(n.href)}return Object(i.useEffect)((function(){return function(){return M()}}),[]),Object(c.jsxs)("div",{className:"".concat(b.a.element," ").concat(d?b.a.display:""),children:[Object(c.jsxs)("div",{className:b.a.info,children:[Object(c.jsx)("div",{children:void 0===n?u.desc.nameless:n}),Object(c.jsxs)("div",{children:[Object(c.jsxs)("div",{children:[Object(c.jsxs)("span",{children:[u.desc.added,":"]}),Object(c.jsx)("span",{children:new Date(o).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})})]}),Object(c.jsxs)("div",{children:[Object(c.jsx)("span",{children:u.desc.lastConnection}),void 0===a?Object(c.jsx)("span",{children:u.desc.status0}):Object(c.jsx)("span",{children:new Date(a).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})})]}),Object(c.jsxs)("div",{children:[Object(c.jsxs)("span",{children:[u.desc.connection,":"]}),function(){switch(k){case 0:return Object(c.jsx)("span",{className:b.a.red,children:u.desc.status0});case 1:return Object(c.jsx)("span",{className:b.a.orange,children:u.desc.status1});case 2:return Object(c.jsx)("span",{className:b.a.green,children:u.desc.status2})}}()]})]})]}),Object(c.jsxs)("div",{className:b.a.chat,children:[Object(c.jsxs)("div",{ref:q,children:[O.map((function(e,t){switch(e.type){case"msg":return Object(c.jsxs)("div",{className:e.current?b.a.right:b.a.left,children:[Object(c.jsx)("div",{children:new Date(e.date).toLocaleTimeString(void 0,{minute:"numeric",hour:"numeric"})}),Object(c.jsx)("div",{children:e.content})]},t);case"file":return Object(c.jsxs)("div",{className:"".concat(e.current?b.a.right:b.a.left," ").concat(b.a.file),onClick:100===e.progress||e.current?function(){return z(e.blob,e.name)}:null,children:[Object(c.jsx)("div",{children:new Date(e.date).toLocaleTimeString(void 0,{minute:"numeric",hour:"numeric"})}),Object(c.jsx)(f.a,{name:"var/save.svg"}),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:e.name}),Object(c.jsxs)("div",{children:[e.progress,"%"]}),Object(c.jsxs)("div",{children:[Math.round(e.size/1024)," ",u.desc.kb]})]})]},t);case"sys":return Object(c.jsx)("div",{className:b.a.system,children:e.content},t)}})),0===k?Object(c.jsx)("button",{onClick:function(){function e(e){var n,c={},r=0,s=[],i=1;e.onopen=function(){P({type:"sys",content:u.desc.msg.opened}),C(2),l(t,"last",Date.now())},e.onclose=function(){M(),C(0),P({type:"sys",content:u.desc.msg.closed})},e.onmessage=function(e){console.log(e.data);try{var t=JSON.parse(e.data),o=t.type,a=t.content;"msg"===o&&P(p({type:o,content:a,current:!1},E())),"file"===o&&(s=[],r=0,c=a,(i=Math.ceil(c.chunks/100))<1&&(i=1),n=p({type:"file",current:!1,name:c.name,size:c.size},E()),P(n))}catch(d){s.push(e.data),++r%i===0&&T(n.id,"progress",Math.round(r/i)),r>=c.chunks&&(T(n.id,"progress",100),T(n.id,"blob",new Blob(s)))}},R.current=e}C(1);var n=new WebSocket(u.server),c=function(e,t){return n.send(JSON.stringify({type:e,content:t}))},r={iceServers:Object.entries(u.iceServers).map((function(e){return e[1]}))},s=new RTCPeerConnection(r);s.onicecandidate=function(e){e.candidate?c("newice",e.candidate):P("Ice candidates \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u044b. \u041e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430.")},s.ondatachannel=function(t){return e(t.channel)},n.onopen=function(){P({type:"sys",content:"\u0423\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a middle-\u0441\u0435\u0440\u0432\u0435\u0440\u0443"}),c("connect",t)},n.onmessage=function(t){var n=JSON.parse(t.data),r=n.type,i=n.content;switch(console.log(i),r){case"connect":P({type:"sys",content:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442 \u043d\u0430\u0439\u0434\u0435\u043d. \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f..."}),s.onnegotiationneeded=function(e){s.createOffer().then((function(e){return s.setLocalDescription(e)})).then((function(){return c("offer",s.localDescription)}))},e(s.createDataChannel("channel"));break;case"offer":P({type:"sys",content:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442 \u043d\u0430\u0439\u0434\u0435\u043d. \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f..."}),console.log({type:r,content:i}),s.setRemoteDescription(new RTCSessionDescription(i)).then((function(){return s.createAnswer()})).then((function(e){return s.setLocalDescription(e)})).then((function(){return c("answer",s.localDescription)}));break;case"answer":console.log({type:r,content:i}),s.setRemoteDescription(new RTCSessionDescription(i));break;case"newice":console.log({type:r,content:i}),s.addIceCandidate(new RTCIceCandidate(i))}},n.onerror=function(e){return console.log("Middle-server connection error")},n.onclose=function(e){return console.log("Middle-server connection closed")},N.current=n,D.current=s},children:u.desc.queryNew}):1===k?Object(c.jsx)("button",{onClick:function(){M(),C(0)},children:u.desc.queryCancel}):null]}),Object(c.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),null===R.current)return P({type:"sys",content:u.desc.msg.notsent});if("open"!==R.current.readyState)switch(R.current.readyState){case"connecting":return P({type:"sys",content:u.desc.msg.connecting});case"closing":return P({type:"sys",content:u.desc.msg.closing});case"close":return P({type:"sys",content:u.desc.msg.close})}!function(e){if(""!==e&&(R.current.send(JSON.stringify({type:"msg",content:e})),P(p({type:"msg",content:e,current:!0},E()))),0!==m.length&&!g){var t,n=function(){0===r&&(R.current.send(JSON.stringify({type:"file",content:{name:m[s].name,chunks:Math.floor(m[s].size/o),size:m[s].size}})),t=p({type:"file",current:!0,blob:m[s],size:m[s].size,name:m[s].name},E()),i=Math.ceil(m[s].size/o/100),P(t));var e=o*r,n=Math.min(m[s].size,e+o);c.readAsArrayBuffer(m[s].slice(e,n))},c=new FileReader,r=0,s=0,i=0,o=8092;w(!0),c.onload=function(){R.current.send(c.result),r%i===0&&T(t.id,"progress",Math.round(r/i)),++r>Math.floor(m[s].size/o)?(T(t.id,"progress",100),s++,m.length>s?(r=0,n()):(y([]),w(!1))):n()},n()}}(e.target.msg.value),e.target.msg.value=""},children:[Object(c.jsx)("div",{style:g?{display:"none"}:{},children:m.map((function(e,t){return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{onClick:function(t){return z(e,e.name)},children:Object(c.jsx)(f.a,{name:"var/file.svg"})},e.lastModified),Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:e.name}),Object(c.jsx)("div",{onClick:function(t){return function(e){return y((function(t){return t.filter((function(t){return t!==e}))}))}(e)},children:Object(c.jsx)(f.a,{name:"var/x.svg"})}),Object(c.jsxs)("div",{children:[Math.round(e.size/1024)," ",u.desc.kb]})]})]},t)}))}),Object(c.jsxs)("div",{children:[Object(c.jsxs)("label",{"data-tooltip":u.desc.attach,children:[Object(c.jsx)("input",{disabled:g,type:"file",multiple:!0,onChange:function(e){return y((function(t){return[].concat(Object(r.a)(t),Object(r.a)(e.target.files))}))}}),Object(c.jsx)(f.a,{name:"var/clip.svg"})]}),Object(c.jsx)("input",{autoComplete:"false",type:"text",name:"msg"}),Object(c.jsxs)("label",{"data-tooltip":u.desc.send,children:[Object(c.jsx)("input",{type:"submit"}),Object(c.jsx)(f.a,{name:"var/send.svg"})]})]})]})]})]})}}}]);