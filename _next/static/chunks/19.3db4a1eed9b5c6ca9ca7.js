(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[19],{DlcB:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var c=n("KQm4"),r=n("rePB"),s=n("q1tI"),i=n("YFqc"),o=n.n(i),a=n("nOHt"),d=n("0FX9"),l=n.n(d),u=n("uXig"),j=n.n(u),b=n("quuy"),O=n("Jq4i"),f=n("nKUr");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,c)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e){var t=e.props,n=Object(s.useState)([]),i=n[0],d=n[1],u=Object(s.useState)(""),h=u[0],v=u[1],y=Object(s.useState)([]),x=y[0],g=y[1],w=Object(s.useState)(!1),S=w[0],k=w[1],C=Object(s.useState)(!1),N=C[0],D=C[1],R=Object(s.useState)(null),q=R[0],M=R[1],P=Object(s.useState)(null),T=P[0],E=P[1],z=Object(s.useState)(null),J=z[0],L=z[1],I=Object(s.useRef)(null),F=Object(s.useRef)(null),U=Object(s.useRef)(null),B=Object(a.useRouter)();function H(e){M(Math.round(1e5*Math.random()));var t=Math.random().toString(36).substr(2);E(t),L(Object(f.jsx)(o.a,{href:{pathname:e,query:{key:t}},children:Object(f.jsxs)("a",{rel:"nofollow",children:["https://regtool.net",e,"?key=",t]})})),D(!1)}function _(e,t,n){d((function(c){return c.map((function(c){return c.code===e?p(p({},c),{},Object(r.a)({},t,n)):c}))}))}function A(e){x.includes(e)||g([].concat(Object(c.a)(x),[e])),v(e)}return Object(s.useEffect)((function(){H(B.asPath);var e=localStorage.getItem("transferConnections");return null!==e&&d(JSON.parse(e)),function(){try{F.current.close()}catch(e){}}}),[]),Object(s.useEffect)((function(){localStorage.setItem("transferConnections",JSON.stringify(i))}),[i]),Object(s.useEffect)((function(){if(void 0!==B.query.key){d((function(e){return[{code:B.query.key,date:Date.now()}].concat(Object(c.a)(e))}));var e=B.asPath.match(/^(.*)\?/)[1];B.replace(e,void 0,{shallow:!0}),A(B.query.key),H(e)}}),[B.query.key]),Object(f.jsxs)("div",{className:j.a.block,ref:I,children:[Object(f.jsxs)("div",{className:j.a.main,children:[Object(f.jsxs)("div",{className:"".concat(j.a.new," ").concat(""===h?j.a.display:""),children:[Object(f.jsx)("div",{}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:Object(f.jsx)("div",{children:t.desc.header1})}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:t.desc.header2}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:t.desc.code.string1}),Object(f.jsxs)("div",{children:[t.desc.code.yourCode,": ",Object(f.jsx)("span",{onClick:function(){navigator.clipboard.writeText("".concat(q))},"data-tooltip":t.desc.clickToCopy,className:j.a.code,children:q})]}),Object(f.jsx)("div",{children:t.desc.code.string2}),S?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("div",{children:t.desc.code.waiting}),Object(f.jsx)("button",{onClick:function(){k(!1),F.current.close()},children:t.desc.code.retry})]}):Object(f.jsxs)("form",{className:j.a.form,onSubmit:function(e){e.preventDefault(),k(!0),F.current=new WebSocket(t.server),F.current.onmessage=function(e){var t=JSON.parse(e.data),n=t.type,r=t.content;switch(n){case"swap":d((function(e){return[{code:r,date:Date.now()}].concat(Object(c.a)(e))})),A(r),F.current.close(),k(!1)}};var n=[e.target.code.value,q].sort().join("");F.current.onopen=function(){return F.current.send(JSON.stringify({type:"swap",content:n}))}},children:[Object(f.jsx)("input",{placeholder:t.desc.code.inputCodePlaceholder,autoComplete:"false",type:"number",name:"code"}),Object(f.jsx)("input",{type:"submit",value:t.desc.code.addContact})]})]})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:t.desc.header3}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:t.desc.qr.string1}),Object(f.jsx)("div",{children:t.desc.qr.string2}),Object(f.jsxs)("div",{children:[J,Object(f.jsx)("button",{onClick:function(){navigator.clipboard.writeText("https://regtool.net".concat(B.asPath,"?key=").concat(T))},children:t.desc.qr.copy})]}),Object(f.jsxs)("div",{className:N?j.a.qrTrue:j.a.qrFalse,children:[Object(f.jsx)("canvas",{ref:U}),Object(f.jsx)("button",{onClick:function(){l.a.toCanvas(U.current,"https://regtool.net".concat(B.asPath,"?key=").concat(T)),D(!0)},children:t.desc.qr.generate})]})]})]})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:t.desc.loss}),Object(f.jsx)("button",{onClick:H,children:t.desc.recreate})]})]}),i.map((function(e){var n=e.code,c=e.name,r=e.date,s=e.last;return x.includes(n)?Object(f.jsx)(m,{display:h===n,code:n,name:c,date:r,last:s,contactEdit:_,props:t},n):null})),Object(f.jsx)(b.a,{elem:I.current})]}),Object(f.jsxs)("div",{className:j.a.contacts,children:[Object(f.jsx)("button",{onClick:function(){return v("")},children:t.desc.add}),Object(f.jsx)("div",{children:i.map((function(e){return Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{onClick:function(){return A(e.code)},children:void 0===e.name?t.desc.nameless:e.name}),Object(f.jsx)("button",{onClick:function(t){var n;t.stopPropagation(),n=e.code,d(i.filter((function(e){return e.code!==n}))),v("")},children:Object(f.jsx)(O.a,{name:"var/x.svg"})}),Object(f.jsx)("div",{children:new Date(e.date).toLocaleTimeString(void 0,{month:"short",day:"numeric",weekday:"short",year:"numeric"})}),Object(f.jsx)("div",{children:void 0===e.last?t.desc.empty:new Date(e.last).toLocaleTimeString(void 0,{month:"short",day:"numeric",weekday:"short",year:"numeric"})})]},e.code)}))})]})]})}function m(e){var t=e.code,n=e.name,i=e.date,o=e.last,a=e.display,d=e.contactEdit,l=e.props,u=Object(s.useState)([]),b=u[0],h=u[1],v=Object(s.useState)([]),m=v[0],y=v[1],x=Object(s.useState)(!1),g=x[0],w=x[1],S=Object(s.useState)(0),k=S[0],C=S[1],N=Object(s.useRef)(null),D=Object(s.useRef)(null),R=Object(s.useRef)(null),q=Object(s.useRef)(null);Object(s.useEffect)((function(){q.current.scrollTop>q.current.scrollHeight-q.current.offsetHeight-300&&(q.current.scrollTop=q.current.scrollHeight)}),[b]);var M=function(){try{R.current.close(),D.current.close(),N.current.close()}catch(e){}};Object(s.useEffect)((function(){0===k&&P({type:"sys",content:l.desc.msg.sysNew})}),[k]);var P=function(e){return h((function(t){return[].concat(Object(c.a)(t),[e])}))},T=function(e,t,n){return h((function(c){return c.map((function(c){return c.id===e?p(p({},c),{},Object(r.a)({},t,n)):c}))}))};function E(){var e=Date.now();return{date:6e4*Math.floor(e/6e4),id:e%1e5}}function z(e,t){var n=document.createElement("a");n.download=t,n.href=URL.createObjectURL(e),n.click(),URL.revokeObjectURL(n.href)}return Object(s.useEffect)((function(){return function(){return M()}}),[]),Object(f.jsxs)("div",{className:"".concat(j.a.element," ").concat(a?j.a.display:""),children:[Object(f.jsxs)("div",{className:j.a.info,children:[Object(f.jsx)("div",{children:void 0===n?l.desc.nameless:n}),Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{children:[Object(f.jsxs)("span",{children:[l.desc.added,":"]}),Object(f.jsx)("span",{children:new Date(i).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("span",{children:l.desc.lastConnection}),void 0===o?Object(f.jsx)("span",{children:l.desc.status0}):Object(f.jsx)("span",{children:new Date(o).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})})]}),Object(f.jsxs)("div",{children:[Object(f.jsxs)("span",{children:[l.desc.connection,":"]}),function(){switch(k){case 0:return Object(f.jsx)("span",{className:j.a.red,children:l.desc.status0});case 1:return Object(f.jsx)("span",{className:j.a.orange,children:l.desc.status1});case 2:return Object(f.jsx)("span",{className:j.a.green,children:l.desc.status2})}}()]})]})]}),Object(f.jsxs)("div",{className:j.a.chat,children:[Object(f.jsxs)("div",{ref:q,children:[b.map((function(e,t){switch(e.type){case"msg":return Object(f.jsxs)("div",{className:e.current?j.a.right:j.a.left,children:[Object(f.jsx)("div",{children:new Date(e.date).toLocaleTimeString(void 0,{minute:"numeric",hour:"numeric"})}),Object(f.jsx)("div",{children:e.content})]},t);case"file":return Object(f.jsxs)("div",{className:"".concat(e.current?j.a.right:j.a.left," ").concat(j.a.file),onClick:100===e.progress||e.current?function(){return z(e.blob,e.name)}:null,children:[Object(f.jsx)("div",{children:new Date(e.date).toLocaleTimeString(void 0,{minute:"numeric",hour:"numeric"})}),Object(f.jsx)(O.a,{name:"var/save.svg"}),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:e.name}),Object(f.jsxs)("div",{children:[e.progress,"%"]}),Object(f.jsxs)("div",{children:[Math.round(e.size/1024)," ",l.desc.kb]})]})]},t);case"sys":return Object(f.jsx)("div",{className:j.a.system,children:e.content},t)}})),0===k?Object(f.jsx)("button",{onClick:function(){function e(e){var n,c={},r=0,s=[],i=1;e.onopen=function(){P({type:"sys",content:l.desc.msg.opened}),C(2),d(t,"last",Date.now())},e.onclose=function(){M(),C(0),P({type:"sys",content:l.desc.msg.closed})},e.onmessage=function(e){console.log(e.data);try{var t=JSON.parse(e.data),o=t.type,a=t.content;"msg"===o&&P(p({type:o,content:a,current:!1},E())),"file"===o&&(s=[],r=0,c=a,(i=Math.ceil(c.chunks/100))<1&&(i=1),n=p({type:"file",current:!1,name:c.name,size:c.size},E()),P(n))}catch(d){s.push(e.data),++r%i===0&&T(n.id,"progress",Math.round(r/i)),r>=c.chunks&&(T(n.id,"progress",100),T(n.id,"blob",new Blob(s)))}},R.current=e}C(1);var n=new WebSocket(l.server),c=function(e,t){return n.send(JSON.stringify({type:e,content:t}))},r={iceServers:Object.entries(l.iceServers).map((function(e){return e[1]}))},s=new RTCPeerConnection(r);s.onicecandidate=function(e){e.candidate?c("newice",e.candidate):P("Ice candidates \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u044b. \u041e\u0436\u0438\u0434\u0430\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430.")},s.ondatachannel=function(t){return e(t.channel)},n.onopen=function(){P({type:"sys",content:"\u0423\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c\u0441\u044f \u043a middle-\u0441\u0435\u0440\u0432\u0435\u0440\u0443"}),c("connect",t)},n.onmessage=function(t){var n=JSON.parse(t.data),r=n.type,i=n.content;switch(console.log(i),r){case"connect":P({type:"sys",content:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442 \u043d\u0430\u0439\u0434\u0435\u043d. \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f..."}),s.onnegotiationneeded=function(e){s.createOffer().then((function(e){return s.setLocalDescription(e)})).then((function(){return c("offer",s.localDescription)}))},e(s.createDataChannel("channel"));break;case"offer":P({type:"sys",content:"\u041a\u043e\u043d\u0442\u0430\u043a\u0442 \u043d\u0430\u0439\u0434\u0435\u043d. \u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f..."}),console.log({type:r,content:i}),s.setRemoteDescription(new RTCSessionDescription(i)).then((function(){return s.createAnswer()})).then((function(e){return s.setLocalDescription(e)})).then((function(){return c("answer",s.localDescription)}));break;case"answer":console.log({type:r,content:i}),s.setRemoteDescription(new RTCSessionDescription(i));break;case"newice":console.log({type:r,content:i}),s.addIceCandidate(new RTCIceCandidate(i))}},n.onerror=function(e){return console.log("Middle-server connection error")},n.onclose=function(e){return console.log("Middle-server connection closed")},N.current=n,D.current=s},children:l.desc.queryNew}):1===k?Object(f.jsx)("button",{onClick:function(){M(),C(0)},children:l.desc.queryCancel}):null]}),Object(f.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),null===R.current)return P({type:"sys",content:l.desc.msg.notsent});if("open"!==R.current.readyState)switch(R.current.readyState){case"connecting":return P({type:"sys",content:l.desc.msg.connecting});case"closing":return P({type:"sys",content:l.desc.msg.closing});case"close":return P({type:"sys",content:l.desc.msg.close})}!function(e){if(""!==e&&(R.current.send(JSON.stringify({type:"msg",content:e})),P(p({type:"msg",content:e,current:!0},E()))),0!==m.length&&!g){var t,n=function(){0===r&&(R.current.send(JSON.stringify({type:"file",content:{name:m[s].name,chunks:Math.floor(m[s].size/o),size:m[s].size}})),t=p({type:"file",current:!0,blob:m[s],size:m[s].size,name:m[s].name},E()),i=Math.ceil(m[s].size/o/100),P(t));var e=o*r,n=Math.min(m[s].size,e+o);c.readAsArrayBuffer(m[s].slice(e,n))},c=new FileReader,r=0,s=0,i=0,o=8092;w(!0),c.onload=function(){R.current.send(c.result),r%i===0&&T(t.id,"progress",Math.round(r/i)),++r>Math.floor(m[s].size/o)?(T(t.id,"progress",100),s++,m.length>s?(r=0,n()):(y([]),w(!1))):n()},n()}}(e.target.msg.value),e.target.msg.value=""},children:[Object(f.jsx)("div",{style:g?{display:"none"}:{},children:m.map((function(e,t){return Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{onClick:function(t){return z(e,e.name)},children:Object(f.jsx)(O.a,{name:"var/file.svg"})},e.lastModified),Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{children:e.name}),Object(f.jsx)("div",{onClick:function(t){return function(e){return y((function(t){return t.filter((function(t){return t!==e}))}))}(e)},children:Object(f.jsx)(O.a,{name:"var/x.svg"})}),Object(f.jsxs)("div",{children:[Math.round(e.size/1024)," ",l.desc.kb]})]})]},t)}))}),Object(f.jsxs)("div",{children:[Object(f.jsxs)("label",{"data-tooltip":l.desc.attach,children:[Object(f.jsx)("input",{disabled:g,type:"file",multiple:!0,onChange:function(e){return y((function(t){return[].concat(Object(c.a)(t),Object(c.a)(e.target.files))}))}}),Object(f.jsx)(O.a,{name:"var/clip.svg"})]}),Object(f.jsx)("input",{autoComplete:"false",type:"text",name:"msg"}),Object(f.jsxs)("label",{"data-tooltip":l.desc.send,children:[Object(f.jsx)("input",{type:"submit"}),Object(f.jsx)(O.a,{name:"var/send.svg"})]})]})]})]})]})}}}]);